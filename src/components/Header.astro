---
import LanguageSwitcher from './LanguageSwitcher.astro';
import CurrencySwitcher from './CurrencySwitcher.astro';
import { useTranslations, getLocalizedPath, type Lang, defaultLang } from '../i18n/translations';

interface Props {
  lang?: Lang;
}

const { lang = defaultLang } = Astro.props;
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: t('nav.home') },
  { href: '/packages', label: t('nav.packages') },
  { href: '/cruises', label: t('nav.cruises') },
  { href: '/groups', label: t('nav.groups') },
  { href: '/about', label: t('nav.about') },
  { href: '/contact', label: t('nav.contact') },
];

function isActive(href: string) {
  const localizedHref = getLocalizedPath(href, lang);
  if (href === '/') {
    return currentPath === '/' || currentPath === `/${lang}` || currentPath === `/${lang}/`;
  }
  return currentPath.includes(href);
}

function getHref(href: string) {
  return getLocalizedPath(href, lang);
}

const isRTL = lang === 'ar';
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="main-header" dir={isRTL ? 'rtl' : 'ltr'}>
  <div class="absolute inset-0 bg-gradient-to-b from-stone-900/80 to-transparent pointer-events-none header-gradient"></div>
  <nav class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href={getHref('/')} class={`flex items-center gap-3 group ${isRTL ? 'flex-row-reverse' : ''}`}>
        <div class="w-12 h-12 bg-gradient-to-br from-sand-400 to-sand-600 rounded-full flex items-center justify-center shadow-lg group-hover:shadow-xl transition-shadow">
          <span class="text-white font-display font-bold text-xl">P</span>
        </div>
        <div class="hidden sm:block">
          <span class="text-white font-display text-xl font-semibold tracking-wide text-shadow">TravelWithPola</span>
          <span class={`block text-sand-300 text-xs font-accent italic ${isRTL ? 'text-right' : ''}`}>
            {lang === 'ar' ? 'اكتشف مصر' : lang === 'es' ? 'Descubre Egipto' : 'Discover Egypt'}
          </span>
        </div>
      </a>
      
      <!-- Desktop Navigation -->
      <div class={`hidden lg:flex items-center gap-1 ${isRTL ? 'flex-row-reverse' : ''}`}>
        {navLinks.map(link => (
          <a 
            href={getHref(link.href)}
            class={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 ${
              isActive(link.href) 
                ? 'bg-white/20 text-white' 
                : 'text-white/80 hover:text-white hover:bg-white/10'
            }`}
          >
            {link.label}
          </a>
        ))}
        
        <div class={`flex items-center gap-2 ${isRTL ? 'mr-4' : 'ml-4'}`}>
          <CurrencySwitcher currentLang={lang} />
          <LanguageSwitcher currentLang={lang} />
        </div>
        
        <a href={getHref('/contact#book')} class={`btn-gold text-sm py-2 px-6 ${isRTL ? 'mr-2' : 'ml-2'}`}>
          {t('nav.bookNow')}
        </a>
      </div>
      
      <!-- Mobile Menu Button -->
      <button 
        class="lg:hidden p-2 rounded-lg text-white hover:bg-white/10 transition-colors"
        id="mobile-menu-btn"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path class="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          <path class="close-icon hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <!-- Mobile Menu -->
    <div class="lg:hidden hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-4 space-y-1 bg-stone-900/95 backdrop-blur-lg rounded-2xl mt-2 border border-white/10">
        {navLinks.map(link => (
          <a 
            href={getHref(link.href)}
            class={`block px-4 py-3 rounded-xl text-base font-medium transition-all ${
              isActive(link.href) 
                ? 'bg-white/20 text-white' 
                : 'text-white/80 hover:text-white hover:bg-white/10'
            }`}
          >
            {link.label}
          </a>
        ))}
        
        <div class="flex gap-2 px-4 py-3">
          <CurrencySwitcher currentLang={lang} />
          <LanguageSwitcher currentLang={lang} />
        </div>
        
        <a href={getHref('/contact#book')} class="block mt-4 btn-gold text-center">
          {t('nav.bookNow')}
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const header = document.getElementById('main-header');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.querySelector('.menu-icon');
  const closeIcon = document.querySelector('.close-icon');
  
  // Scroll behavior
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 100) {
      header?.classList.add('bg-stone-900/95', 'backdrop-blur-lg', 'shadow-xl');
      header?.querySelector('.header-gradient')?.classList.add('opacity-0');
    } else {
      header?.classList.remove('bg-stone-900/95', 'backdrop-blur-lg', 'shadow-xl');
      header?.querySelector('.header-gradient')?.classList.remove('opacity-0');
    }
    
    lastScroll = currentScroll;
  });
  
  // Mobile menu toggle
  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });
</script>
